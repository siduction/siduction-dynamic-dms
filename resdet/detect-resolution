#!/bin/sh

if [ -f /etc/default/distro ]; then
	. /etc/default/distro
fi

# Detects actual display resolution
# Warning ... works only with a single video card 
xrandr -q > /usr/share/siduction-dynamic-dms/xoutput
det_res=$(cat /usr/share/siduction-dynamic-dms/xoutput | head -n 1 | awk '{print $8.$9.$10}'| cut -d , -f1 )
rm -f /usr/share/siduction-dynamic-dms/xoutput

# Detects only wallpaper name for razor theme
razor_theme=$(echo ${FLL_WALLPAPER} | cut -d / -f 5)

# Searches if exists a wallpaper with desired resolution and
# make a new link for it if true as default wallpaper
# it's needed a hard link for cinnamon
if [ -f "${FLL_WALLPAPER}/contents/images/${det_res}.jpg" ];then
	ln -f  ${FLL_WALLPAPER}/contents/images/${det_res}.jpg ${FLL_WALLPAPER}.jpg 
	# razor qt part
	if [ -s /usr/share/razor/themes/${razor_theme}/1024x768.jpg ];then
		ln -sf  ${FLL_WALLPAPER}/contents/images/${det_res}.jpg \
		/usr/share/razor/themes/${razor_theme}/1024x768.jpg
	fi
fi

exit 0



